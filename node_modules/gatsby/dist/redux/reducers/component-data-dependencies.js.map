{"version":3,"sources":["../../../src/redux/reducers/component-data-dependencies.js"],"names":["_","require","module","exports","state","nodes","connections","action","type","payload","path","nodeId","existingPaths","newPaths","uniq","concat","id","connection","mapValues","difference","paths"],"mappings":";;AAAA,IAAMA,IAAIC,QAAS,QAAT,CAAV;;AAEAC,OAAOC,OAAP,GAAiB,YAAoD;AAAA,MAAnDC,KAAmD,uEAA3C,EAAEC,OAAO,EAAT,EAAaC,aAAa,EAA1B,EAA2C;AAAA,MAAXC,MAAW;;AACnE,UAAQA,OAAOC,IAAf;AACE,SAAM,cAAN;AACE,aAAO,EAAEH,OAAO,EAAT,EAAaC,aAAa,EAA1B,EAAP;AACF,SAAM,6BAAN;AACE,UAAIC,OAAOE,OAAP,CAAeC,IAAf,KAAyB,EAA7B,EAAgC;AAC9B,eAAON,KAAP;AACD;;AAED;AACA,UAAIG,OAAOE,OAAP,CAAeE,MAAnB,EAA2B;AACzB,YAAIC,gBAAgB,EAApB;AACA,YAAIR,MAAMC,KAAN,CAAYE,OAAOE,OAAP,CAAeE,MAA3B,CAAJ,EAAwC;AACtCC,0BAAgBR,MAAMC,KAAN,CAAYE,OAAOE,OAAP,CAAeE,MAA3B,CAAhB;AACD;AACD,YAAME,WAAWb,EAAEc,IAAF,CACfF,cAAcG,MAAd,CAAqBR,OAAOE,OAAP,CAAeC,IAAf,IAAuBH,OAAOE,OAAP,CAAeO,EAA3D,CADe,CAAjB;AAGAZ,cAAMC,KAAN,CAAYE,OAAOE,OAAP,CAAeE,MAA3B,IAAqCE,QAArC;AACD;;AAED;AACA,UAAIN,OAAOE,OAAP,CAAeQ,UAAnB,EAA+B;AAC7B,YAAIL,iBAAgB,EAApB;AACA,YAAIR,MAAME,WAAN,CAAkBC,OAAOE,OAAP,CAAeQ,UAAjC,CAAJ,EAAkD;AAChDL,2BAAgBR,MAAME,WAAN,CAAkBC,OAAOE,OAAP,CAAeQ,UAAjC,CAAhB;AACD;AACD,YAAMJ,YAAWb,EAAEc,IAAF,CACfF,eAAcG,MAAd,CAAqBR,OAAOE,OAAP,CAAeC,IAAf,IAAuBH,OAAOE,OAAP,CAAeO,EAA3D,CADe,CAAjB;AAGAZ,cAAME,WAAN,CAAkBC,OAAOE,OAAP,CAAeQ,UAAjC,IAA+CJ,SAA/C;AACD;;AAED,aAAOT,KAAP;AACF,SAAM,gCAAN;AACEA,YAAMC,KAAN,GAAcL,EAAEkB,SAAF,CAAYd,MAAMC,KAAlB,EAAyB;AAAA,eACrCL,EAAEmB,UAAF,CAAaC,KAAb,EAAoBb,OAAOE,OAAP,CAAeW,KAAnC,CADqC;AAAA,OAAzB,CAAd;AAGAhB,YAAME,WAAN,GAAoBN,EAAEkB,SAAF,CAAYd,MAAME,WAAlB,EAA+B;AAAA,eACjDN,EAAEmB,UAAF,CAAaC,KAAb,EAAoBb,OAAOE,OAAP,CAAeW,KAAnC,CADiD;AAAA,OAA/B,CAApB;;AAIA,aAAOhB,KAAP;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACE,aAAOA,KAAP;AAtDJ;AAwDD,CAzDD","file":"component-data-dependencies.js","sourcesContent":["const _ = require(`lodash`)\n\nmodule.exports = (state = { nodes: {}, connections: {} }, action) => {\n  switch (action.type) {\n    case `DELETE_CACHE`:\n      return { nodes: {}, connections: {} }\n    case `CREATE_COMPONENT_DEPENDENCY`:\n      if (action.payload.path === ``) {\n        return state\n      }\n\n      // If this nodeId not set yet.\n      if (action.payload.nodeId) {\n        let existingPaths = []\n        if (state.nodes[action.payload.nodeId]) {\n          existingPaths = state.nodes[action.payload.nodeId]\n        }\n        const newPaths = _.uniq(\n          existingPaths.concat(action.payload.path || action.payload.id)\n        )\n        state.nodes[action.payload.nodeId] = newPaths\n      }\n\n      // If this connection not set yet.\n      if (action.payload.connection) {\n        let existingPaths = []\n        if (state.connections[action.payload.connection]) {\n          existingPaths = state.connections[action.payload.connection]\n        }\n        const newPaths = _.uniq(\n          existingPaths.concat(action.payload.path || action.payload.id)\n        )\n        state.connections[action.payload.connection] = newPaths\n      }\n\n      return state\n    case `DELETE_COMPONENTS_DEPENDENCIES`:\n      state.nodes = _.mapValues(state.nodes, paths =>\n        _.difference(paths, action.payload.paths)\n      )\n      state.connections = _.mapValues(state.connections, paths =>\n        _.difference(paths, action.payload.paths)\n      )\n\n      return state\n    // Don't delete data dependencies as we're now deleting transformed nodes\n    // when their parent is changed. WIth the code below as stands, this\n    // would delete the connection between the page and the transformed\n    // node which will be recreated after its deleted meaning the query\n    // won't be re-run.\n    // case `DELETE_NODE`:\n    // delete state.nodes[action.payload]\n    // return state\n    // case `DELETE_NODES`:\n    // action.payload.forEach(n => delete state.nodes[n])\n    // return state\n    default:\n      return state\n  }\n}\n"]}